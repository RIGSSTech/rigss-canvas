(window["canvasWebpackJsonp"] = window["canvasWebpackJsonp"] || []).push([["deep_linking_response"],{

/***/ "4yER":
/*!****************************************************!*\
  !*** ./ui/features/deep_linking_response/index.ts ***!
  \****************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _react_DeepLinkingResponse__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./react/DeepLinkingResponse */ \"klPc\");\n/* harmony import */ var _instructure_ready__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @instructure/ready */ \"3lLS\");\n/* harmony import */ var _instructure_ready__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_instructure_ready__WEBPACK_IMPORTED_MODULE_1__);\n/*\n * Copyright (C) 2018 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n_instructure_ready__WEBPACK_IMPORTED_MODULE_1___default()(() => {\n  _react_DeepLinkingResponse__WEBPACK_IMPORTED_MODULE_0__[\"default\"].mount();\n});\n\n//# sourceURL=webpack:///./ui/features/deep_linking_response/index.ts?");

/***/ }),

/***/ "klPc":
/*!*************************************************************************!*\
  !*** ./ui/features/deep_linking_response/react/DeepLinkingResponse.tsx ***!
  \*************************************************************************/
/*! exports provided: RetrievingContent, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RetrievingContent\", function() { return RetrievingContent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return DeepLinkingResponse; });\n/* harmony import */ var _canvas_i18n__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @canvas/i18n */ \"HGxv\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! react */ \"q1tI\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-dom */ \"i8i4\");\n/* harmony import */ var react_dom__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(react_dom__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _instructure_ui_text__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @instructure/ui-text */ \"iE3e\");\n/* harmony import */ var _instructure_ui_spinner__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @instructure/ui-spinner */ \"cPO5\");\n/* harmony import */ var _instructure_ui_flex__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @instructure/ui-flex */ \"N46v\");\n/* harmony import */ var _instructure_ui_buttons__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @instructure/ui-buttons */ \"K6WN\");\n/* harmony import */ var _instructure_ui_table__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @instructure/ui-table */ \"+DUA\");\n/* harmony import */ var _instructure_ui_pill__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @instructure/ui-pill */ \"nJOR\");\n/* harmony import */ var _instructure_ui_view__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @instructure/ui-view */ \"OkHH\");\n/*\n * Copyright (C) 2018 - present Instructure, Inc.\n *\n * This file is part of Canvas.\n *\n * Canvas is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, version 3 of the License.\n *\n * Canvas is distributed in the hope that it will be useful, but WITHOUT ANY\n * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR\n * A PARTICULAR PURPOSE. See the GNU Affero General Public License for more\n * details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\n\n\n\n\n\n\n\n\n\nconst I18n = Object(_canvas_i18n__WEBPACK_IMPORTED_MODULE_0__[\"useScope\"])('external_content.success'); // Doing this to avoid TS2339 errors-- remove and rename once we're on InstUI 8\n\nconst {\n  Item: FlexItem\n} = _instructure_ui_flex__WEBPACK_IMPORTED_MODULE_5__[\"Flex\"];\nconst {\n  Head: TableHead,\n  Row: TableRow,\n  ColHeader: TableColHeader,\n  Body: TableBody,\n  Cell: TableCell\n} = _instructure_ui_table__WEBPACK_IMPORTED_MODULE_7__[\"Table\"];\n\nconst header = () => /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_view__WEBPACK_IMPORTED_MODULE_9__[\"View\"], {\n  display: \"inline-block\",\n  padding: \"none small\",\n  borderWidth: \"none none none large\",\n  borderColor: \"danger\"\n}, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_view__WEBPACK_IMPORTED_MODULE_9__[\"View\"], {\n  display: \"block\"\n}, I18n.t('One or more content items sent by this external app failed to process correctly. ' + 'These have not been saved by Canvas, and the reasons for failure are listed below.')), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_view__WEBPACK_IMPORTED_MODULE_9__[\"View\"], {\n  display: \"block\",\n  margin: \"small 0 0 0\"\n}, I18n.t('All items marked \"processed\" have been saved by Canvas.')));\n\nconst renderContentItem = item => {\n  var _item$error, _item$error2;\n\n  let key = item.title;\n  let pill = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_pill__WEBPACK_IMPORTED_MODULE_8__[\"Pill\"], {\n    color: \"success\"\n  }, I18n.t('Processed'));\n\n  if (item.error) {\n    key = `${item.title}.${item.error.field}`;\n    pill = /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_pill__WEBPACK_IMPORTED_MODULE_8__[\"Pill\"], {\n      color: \"danger\"\n    }, I18n.t('Discarded'));\n  }\n\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableRow, {\n    key: key\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableCell, null, item.title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableCell, null, pill), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableCell, null, (_item$error = item.error) === null || _item$error === void 0 ? void 0 : _item$error.field), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableCell, null, (_item$error2 = item.error) === null || _item$error2 === void 0 ? void 0 : _item$error2.message));\n};\n\nconst buildContentItems = items => items.reduce((acc, item) => {\n  if (item.errors) {\n    const errorItems = Object.entries(item.errors).map(([field, message]) => ({\n      title: item.title,\n      error: {\n        field,\n        message\n      }\n    }));\n    return [...acc, ...errorItems];\n  }\n\n  return [...acc, {\n    title: item.title\n  }];\n}, []);\n\nconst RetrievingContent = ({\n  environment,\n  parentWindow\n}) => {\n  const subject = 'LtiDeepLinkingResponse';\n  const deepLinkResponse = environment.deep_link_response;\n  const [hasErrors, setHasErrors] = Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useState\"])(false);\n  const [contentItems, setContentItems] = Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useState\"])([]);\n  const sendMessage = Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useCallback\"])(() => {\n    parentWindow.postMessage({\n      subject,\n      ...deepLinkResponse\n    }, environment.DEEP_LINKING_POST_MESSAGE_ORIGIN);\n  }, [deepLinkResponse, environment.DEEP_LINKING_POST_MESSAGE_ORIGIN, parentWindow]);\n  Object(react__WEBPACK_IMPORTED_MODULE_1__[\"useEffect\"])(() => {\n    const anyItemHasError = deepLinkResponse.content_items.some(item => Object.keys(item.errors || {}).length > 0);\n    setHasErrors(anyItemHasError);\n\n    if (!anyItemHasError) {\n      sendMessage();\n      return;\n    }\n\n    const items = buildContentItems(deepLinkResponse.content_items);\n    setContentItems(items);\n  }, [deepLinkResponse.content_items, sendMessage]);\n\n  if (hasErrors) {\n    return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_flex__WEBPACK_IMPORTED_MODULE_5__[\"Flex\"], {\n      justifyItems: \"center\",\n      direction: \"column\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(FlexItem, null, header()), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(FlexItem, {\n      margin: \"medium 0\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_table__WEBPACK_IMPORTED_MODULE_7__[\"Table\"], {\n      caption: I18n.t('Content Items with Errors')\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableHead, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableRow, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableColHeader, null, I18n.t('Content Item Title')), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableColHeader, null, I18n.t('Status')), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableColHeader, null, I18n.t('Field')), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableColHeader, null, I18n.t('Error')))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(TableBody, null, contentItems.map(item => renderContentItem(item))))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(FlexItem, {\n      overflowY: \"hidden\"\n    }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_buttons__WEBPACK_IMPORTED_MODULE_6__[\"Button\"], {\n      margin: \"none small\",\n      color: \"primary\",\n      onClick: () => {\n        setHasErrors(false);\n        sendMessage();\n      }\n    }, I18n.t('I Understand, Continue'))));\n  }\n\n  const message = I18n.t('Retrieving Content');\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(\"div\", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_flex__WEBPACK_IMPORTED_MODULE_5__[\"Flex\"], {\n    justifyItems: \"center\",\n    margin: \"x-large 0 large 0\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(FlexItem, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_spinner__WEBPACK_IMPORTED_MODULE_4__[\"Spinner\"], {\n    renderTitle: message,\n    size: \"large\"\n  }))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_flex__WEBPACK_IMPORTED_MODULE_5__[\"Flex\"], {\n    justifyItems: \"center\",\n    margin: \"0 0 large\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(FlexItem, null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_instructure_ui_text__WEBPACK_IMPORTED_MODULE_3__[\"Text\"], {\n    size: \"x-large\",\n    fontStyle: \"italic\"\n  }, message))));\n};\nclass DeepLinkingResponse {\n  static mount() {\n    const parentWindow = window.opener || window.top;\n    react_dom__WEBPACK_IMPORTED_MODULE_2___default.a.render( /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(RetrievingContent, {\n      environment: window.ENV,\n      parentWindow: parentWindow\n    }), document.getElementById('deepLinkingContent'));\n  }\n\n}\n\n//# sourceURL=webpack:///./ui/features/deep_linking_response/react/DeepLinkingResponse.tsx?");

/***/ })

}]);